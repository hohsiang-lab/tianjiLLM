// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: prompt_mgmt.sql

package db

import (
	"context"
)

const createPromptTemplate = `-- name: CreatePromptTemplate :one
INSERT INTO "PromptTemplateTable" (name, version, template, variables, model, metadata)
VALUES ($1, $2, $3, $4, $5, $6)
RETURNING id, name, version, template, variables, model, metadata, created_at
`

type CreatePromptTemplateParams struct {
	Name      string   `json:"name"`
	Version   int32    `json:"version"`
	Template  string   `json:"template"`
	Variables []string `json:"variables"`
	Model     *string  `json:"model"`
	Metadata  []byte   `json:"metadata"`
}

func (q *Queries) CreatePromptTemplate(ctx context.Context, arg CreatePromptTemplateParams) (PromptTemplateTable, error) {
	row := q.db.QueryRow(ctx, createPromptTemplate,
		arg.Name,
		arg.Version,
		arg.Template,
		arg.Variables,
		arg.Model,
		arg.Metadata,
	)
	var i PromptTemplateTable
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Version,
		&i.Template,
		&i.Variables,
		&i.Model,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const deletePromptTemplate = `-- name: DeletePromptTemplate :exec
DELETE FROM "PromptTemplateTable" WHERE id = $1
`

func (q *Queries) DeletePromptTemplate(ctx context.Context, id string) error {
	_, err := q.db.Exec(ctx, deletePromptTemplate, id)
	return err
}

const getLatestPromptByName = `-- name: GetLatestPromptByName :one
SELECT id, name, version, template, variables, model, metadata, created_at FROM "PromptTemplateTable"
WHERE name = $1
ORDER BY version DESC
LIMIT 1
`

func (q *Queries) GetLatestPromptByName(ctx context.Context, name string) (PromptTemplateTable, error) {
	row := q.db.QueryRow(ctx, getLatestPromptByName, name)
	var i PromptTemplateTable
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Version,
		&i.Template,
		&i.Variables,
		&i.Model,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getNextPromptVersion = `-- name: GetNextPromptVersion :one
SELECT COALESCE(MAX(version), 0) + 1 AS next_version
FROM "PromptTemplateTable"
WHERE name = $1
`

func (q *Queries) GetNextPromptVersion(ctx context.Context, name string) (int32, error) {
	row := q.db.QueryRow(ctx, getNextPromptVersion, name)
	var next_version int32
	err := row.Scan(&next_version)
	return next_version, err
}

const getPromptTemplate = `-- name: GetPromptTemplate :one
SELECT id, name, version, template, variables, model, metadata, created_at FROM "PromptTemplateTable" WHERE id = $1
`

func (q *Queries) GetPromptTemplate(ctx context.Context, id string) (PromptTemplateTable, error) {
	row := q.db.QueryRow(ctx, getPromptTemplate, id)
	var i PromptTemplateTable
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Version,
		&i.Template,
		&i.Variables,
		&i.Model,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getPromptTemplateByNameVersion = `-- name: GetPromptTemplateByNameVersion :one
SELECT id, name, version, template, variables, model, metadata, created_at FROM "PromptTemplateTable"
WHERE name = $1 AND version = $2
`

type GetPromptTemplateByNameVersionParams struct {
	Name    string `json:"name"`
	Version int32  `json:"version"`
}

func (q *Queries) GetPromptTemplateByNameVersion(ctx context.Context, arg GetPromptTemplateByNameVersionParams) (PromptTemplateTable, error) {
	row := q.db.QueryRow(ctx, getPromptTemplateByNameVersion, arg.Name, arg.Version)
	var i PromptTemplateTable
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Version,
		&i.Template,
		&i.Variables,
		&i.Model,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getPromptVersions = `-- name: GetPromptVersions :many
SELECT id, name, version, template, variables, model, metadata, created_at FROM "PromptTemplateTable"
WHERE name = $1
ORDER BY version DESC
`

func (q *Queries) GetPromptVersions(ctx context.Context, name string) ([]PromptTemplateTable, error) {
	rows, err := q.db.Query(ctx, getPromptVersions, name)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PromptTemplateTable
	for rows.Next() {
		var i PromptTemplateTable
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Version,
			&i.Template,
			&i.Variables,
			&i.Model,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPromptTemplates = `-- name: ListPromptTemplates :many
SELECT DISTINCT ON (name) id, name, version, template, variables, model, metadata, created_at
FROM "PromptTemplateTable"
ORDER BY name, version DESC
`

func (q *Queries) ListPromptTemplates(ctx context.Context) ([]PromptTemplateTable, error) {
	rows, err := q.db.Query(ctx, listPromptTemplates)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PromptTemplateTable
	for rows.Next() {
		var i PromptTemplateTable
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Version,
			&i.Template,
			&i.Variables,
			&i.Model,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
